name: Update Curriculum Date

on:
  pull_request:
    types: [closed]
    branches:
      - master
      - main

jobs:
  update-date:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.base.ref }}
      
      - name: Update curriculum date in README
        run: |
          CURRENT_DATE=$(date +"%B %d, %Y")
          sed -i "s/\*\*Curriculum updated:\*\* .*/\*\*Curriculum updated:\*\* $CURRENT_DATE/" README.md

      - name: Create pull request if changed
        uses: peter-evans/create-pull-request@v6
        with:
          base: ${{ github.event.pull_request.base.ref }}
          branch: chore/update-curriculum-date
          branch-suffix: timestamp
          delete-branch: true
          commit-message: "chore: update curriculum date [skip ci]"
          title: "chore: update curriculum date"
          body: "Automated update of the Curriculum updated date in README.md."
